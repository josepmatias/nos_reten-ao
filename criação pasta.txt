'Sub dados_carregados(Optional ciclo As String = "reactiva")
Sub dados_carregados()
    
    Dim folha As Worksheet
    Dim directoria_base, directoria_especifica, directoria_completa As String
    Dim ano, mes, template, folder_path, folder_path_completa As String
    Dim fich_template, fich_ciclo, livro_destino As Workbook
    Dim combo As ComboBox
    
    'definir folha base
    Set livro = ThisWorkbook
    Set folha = livro.Sheets("dados carregados")
    
    'definir combobox
    Set combo = folha.OLEObjects("ComboBox1").Object
    
    'acrescentar ciclos á combobox
    
    Call adicionar_combo(combo)
    
    
    Debug.Print combo.Name
    
    'definir directoria_base
    directoria_base = folha.Range("c2")
    
    'definir ano
    ano = folha.Range("c3")
    
    'definir mês
    mes = folha.Range("c4")
    
    'definir directoria_especifica
    'directoria_especifica = folha.Range("c5") 'já não é preciso
    
    'definir template
    'template = folha.Range("c6") 'já não é preciso
    
    'definir directoria_completa
    
    'directoria_completa = directoria_base & ano & mes & directoria_especifica & template
    
    'Debug.Print directoria_completa
    
    'abrir ficheiro ".resumo.templates"
    
    'Set fich_template = Workbooks.Open(directoria_completa)
    
    
    'definir o ciclo e abrir o ficheiro correspondente
    
    Call criacao_pasta(combo, directoria_base, ano, mes, folha)
    
    MsgBox "FIM!"
    
End Sub

Sub criacao_pasta(ByVal combo As ComboBox, ByVal directoria_base As String, ByVal ano As String, _
ByVal mes As String, ByVal folha As Worksheet)

Dim folder_path As String
Dim fich_ciclo, livro_destino As Workbook

Application.DisplayAlerts = False
    
If combo.Value = "reactiva" Then
        
    'folder_path especifica o caminho onde criar pasta temporária
    folder_path = directoria_base & ano & mes
    MkDir folder_path & folha.Range("p2") & "TEMPORÁRIO"
        
    'abrir o ficheiro com o ciclo
        
    Set fich_ciclo = Workbooks.Open(directoria_base & ano & mes & folha.Range("k2"))
    
Else
    
    'folder_path especifica o caminho onde criar pasta temporária
    folder_path = directoria_base & ano & mes
    MkDir folder_path & folha.Range("p3") & "TEMPORÁRIO"
        
    'abrir o ficheiro com o ciclo
        
    Set fich_ciclo = Workbooks.Open(directoria_base & ano & mes & folha.Range("k3"))
End If
        
    Set livro_destino = Workbooks.Add
        
    fich_ciclo.Sheets("Dados Carregados").Copy after:=livro_destino.Sheets(livro_destino. _
    Sheets.Count)
        
    fich_ciclo.Sheets(1).Delete
        
    'gravar o ficheiro temporário
        
    livro_destino.SaveAs folder_path & folha.Range("p3") & "TEMPORÁRIO\dados carregados"


    
Application.DisplayAlerts = True
    

End Sub